#!/usr/bin/python
# coding: utf-8

'usage: macos-trash [-h] [path [path ...]]'

import os
import re
import sys
import glob
from subprocess import Popen, PIPE


applescript =\
'''
on run argv
    set filepaths to {}

    repeat with f in argv
        set end of filepaths to (f as POSIX file)
    end repeat

    tell application "Finder"
        delete filepaths
    end tell
end run
'''

def listpaths(pathnames):
    '''Return full paths of files and/or directories from pathnames
    
    Args:
    - pathnames (list of str): pathname patterns (e.g. ['spam.txt', '*.pdf'])
    
    Returns:
    - filepaths (list of str): full paths of matched files and/or directories
    '''
    filepaths = []

    for p in pathnames:
        matched = glob.glob(p)
        filepaths += map(os.path.abspath, matched)
        
        if len(matched) == 0:
            print('{}: file or directory does not exist.'.format(p))

    return filepaths


if __name__ == '__main__':
    args = sys.argv[1:]

    if len(args) == 0:
        print(__doc__)
        sys.exit()

    if re.search('^-+', args[0]):
        if args[0] in ['-h', '--help']:
            print(__doc__)
        else:
            print('{}: illegal option'.format(args[0]))

        sys.exit()

    filepaths = listpaths(args)
    proc = Popen(['osascript', '-'] + filepaths, stdin=PIPE, stdout=PIPE, stderr=PIPE)
    proc.communicate(applescript)
